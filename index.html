<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GAME AFTER LUNCH - Leaderboard</title>
<link rel="icon" type="image/png" href="assets/img/logo_gold.png"/>
<link href="../../bootstrap-5.3.8-dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #004632, #00805c);
  color: white;
  margin: 0;
  padding: 1em;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.main-card {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  padding: 2.5em 3em;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  max-width: 1200px;
  width: 100%;
  text-align: center;
  animation: fadeIn 0.6s ease-in-out;
}

.logo {
  width: 110px;
  margin-bottom: 1em;
}

h1 {
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: #d4b47e;
  margin-bottom: 0.4em;
}

.search-row {
  display: flex;
  justify-content: center;
  margin-bottom: 1em;
  gap: 0.5em;
  flex-wrap: wrap;
}

.search-row input {
  padding: 0.5em 1em;
  border-radius: 8px;
  border: 1px solid #FFD700;
  background-color: rgba(255,255,255,0.1);
  color: white;
  width: 200px;
}

.search-row button {
  background: linear-gradient(135deg, #be8406, #e6b34d);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 0.5em 1.5em;
  font-weight: bold;
  letter-spacing: 1px;
  cursor: pointer;
  transition: 0.3s;
  box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
}

.search-row button:hover {
  transform: scale(1.05);
  background: linear-gradient(135deg, #e6b34d, #be8406);
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
}

.card-player {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.15);
  border-radius: 15px;
  padding: 1em;
  margin-bottom: 1em;
  display: none;
  text-align: center;
  animation: fadeIn 0.5s ease-in-out;
}

.card-player img {
  width: 100px;
  height: 140px;
  object-fit: cover;
  border-radius: 10px;
  margin-bottom: 0.5em;
}

.badge-icon {
  width: 20px;
  height: 20px;
  vertical-align: middle;
  margin-right: 4px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
  backdrop-filter: blur(5px);
  border-radius: 12px;
  overflow: hidden;
}

th, td {
  padding: 0.8em;
  text-align: center;
  border-bottom: 1px solid rgba(255,255,255,0.3);
}

th {
  background: rgba(255, 215, 0, 0.8);
  color: #004632;
  font-weight: bold;
}

tr:nth-child(even) {
  background: rgba(255,255,255,0.05);
}

tr.top1 { background: rgba(255,215,0,0.5); font-weight: bold; }
tr.top2 { background: rgba(192,192,192,0.5); font-weight: bold; }
tr.top3 { background: rgba(205,127,50,0.5); font-weight: bold; }

.message {
  text-align: center;
  margin-top: 1em;
  font-weight: bold;
}

@keyframes fadeIn {
  from {opacity: 0; transform: translateY(20px);}
  to {opacity: 1; transform: translateY(0);}
}

@media (max-width: 480px) {
  .search-row { flex-direction: column; align-items: stretch; }
  .search-row input, .search-row button { width: 100%; }
}
</style>
</head>

<body>
<div class="main-card" id="dashboard-card">
  <img src="assets/img/logo_gold.png" alt="Logo" class="logo">
  <h1>Leaderboard</h1>

  <div class="search-row">
    <input type="text" id="searchInput" placeholder="Cari Nama">
    <button onclick="filterData()">Cari</button>
    <button onclick="adminPage()">Admin</button>
    <button onclick="goToBadgeGallery()">Lihat Badge</button>
  </div>

  <div id="playerCard" class="card-player">
    <img id="playerPhoto" src="" alt="Foto Pemain">
    <p><strong>Nama:</strong> <span id="playerName">-</span></p>
    <p><strong>Kelas:</strong> <span id="playerClass">-</span></p>
    <p><strong>Total Score:</strong> <span id="playerTotal">-</span></p>
    <p><strong>Badge:</strong> <span id="playerBadges">-</span></p>
  </div>

  <div id="msg" class="message"></div>

  <table>
    <thead>
      <tr>
        <th>Rank</th>
        <th>Nama</th>
        <th>Kelas</th>
        <th>UNO</th>
        <th>Catur</th>
        <th>UNO Balok</th>
        <th>Tepok Nyamuk</th>
        <th>Total Score</th>
        <th>Badge</th>
      </tr>
    </thead>
    <tbody id="leaderboard-body"></tbody>
  </table>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwN7tLWg7cSqJeScydRjpJnyROGm_XLaueVQEkhwfTDwXdG06eYD4pSmtWxXBbaIJKA/exec";
let allPlayers = [];

window.addEventListener("DOMContentLoaded", () => {
  fetchLeaderboard();
});



function fetchLeaderboard() {
  const msg = document.getElementById("msg");
  msg.textContent = "⏳ Memuat leaderboard...";
  msg.style.color = "white";

  fetch(`${SCRIPT_URL}?all=1`)
    .then(res => res.json())
    .then(data => {
      allPlayers = data.sort((a,b) => (b.total_score || 0) - (a.total_score || 0));
      renderTable(allPlayers);
      msg.textContent = "";
    })
    .catch(() => {
      msg.textContent = "⚠️ Gagal memuat leaderboard";
      msg.style.color = "red";
    });
}

// Badge dengan icon
function getBadges(player) {
  const badgeIcons = {
    // UNO
    "Quick Draw": "assets/badge/uno1.png",
    "Card Master": "assets/badge/uno2.png",
    "Deck Dominator": "assets/badge/uno3.png",
    "UNO Legend": "assets/badge/uno4.png",
    "Ultimate Trickster": "assets/badge/uno5.png",
    "Grandmaster of UNO": "assets/badge/uno6.png",

    // Chess
    "Pawn Starter": "assets/badge/chess1.png",
    "Knight Tactician": "assets/badge/chess2.png",
    "Rook Strategist": "assets/badge/chess3.png",
    "Queen’s Gambit": "assets/badge/chess4.png",
    "King Slayer": "assets/badge/chess5.png",
    "Chess Grandmaster": "assets/badge/chess6.png",

    // Jenga
    "Steady Hands": "assets/badge/jenga1.png",
    "Block Builder": "assets/badge/jenga2.png",
    "Tower Architect": "assets/badge/jenga3.png",
    "Balance Master": "assets/badge/jenga4.png",
    "Stacking Genius": "assets/badge/jenga5.png",
    "Jenga Legend": "assets/badge/jenga6.png",

    // Mosquito Slap
    "Quick Reflex": "assets/badge/mosquito1.png",
    "Mosquito Hunter": "assets/badge/mosquito2.png",
    "Slap Expert": "assets/badge/mosquito3.png",
    "Insect Terminator": "assets/badge/mosquito4.png",
    "Bug Obliterator": "assets/badge/mosquito5.png",
    "Mosquito Slayer": "assets/badge/mosquito6.png"
  };

  let badges = [];

  // 🔹 UNO: ambil badge tertinggi
  if (player.uno >= 100) badges.push("Grandmaster of UNO");
  else if (player.uno >= 70) badges.push("Ultimate Trickster");
  else if (player.uno >= 40) badges.push("UNO Legend");
  else if (player.uno >= 20) badges.push("Deck Dominator");
  else if (player.uno >= 10) badges.push("Card Master");
  else if (player.uno >= 5) badges.push("Quick Draw");

  // 🔹 Chess
  if (player.catur >= 100) badges.push("Chess Grandmaster");
  else if (player.catur >= 70) badges.push("King Slayer");
  else if (player.catur >= 40) badges.push("Queen’s Gambit");
  else if (player.catur >= 20) badges.push("Rook Strategist");
  else if (player.catur >= 10) badges.push("Knight Tactician");
  else if (player.catur >= 5) badges.push("Pawn Starter");

  // 🔹 Jenga
  if (player.uno_balok >= 100) badges.push("Jenga Legend");
  else if (player.uno_balok >= 70) badges.push("Stacking Genius");
  else if (player.uno_balok >= 40) badges.push("Balance Master");
  else if (player.uno_balok >= 20) badges.push("Tower Architect");
  else if (player.uno_balok >= 10) badges.push("Block Builder");
  else if (player.uno_balok >= 5) badges.push("Steady Hands");

  // 🔹 Mosquito Slap
  if (player.tepok_nyamuk >= 100) badges.push("Mosquito Slayer");
  else if (player.tepok_nyamuk >= 70) badges.push("Bug Obliterator");
  else if (player.tepok_nyamuk >= 40) badges.push("Insect Terminator");
  else if (player.tepok_nyamuk >= 20) badges.push("Slap Expert");
  else if (player.tepok_nyamuk >= 10) badges.push("Mosquito Hunter");
  else if (player.tepok_nyamuk >= 5) badges.push("Quick Reflex");

  if (!badges.length) return "-";

  return badges.map(b => `<img src="${badgeIcons[b]}" class="badge-icon" title="${b}"> ${b}`).join("<br>");
}



function renderTable(players) {
  const tbody = document.getElementById("leaderboard-body");
  tbody.innerHTML = "";
  players.forEach((p, index) => {
    let trClass = "";
    if(index === 0) trClass = "top1";
    else if(index === 1) trClass = "top2";
    else if(index === 2) trClass = "top3";

    const tr = document.createElement("tr");
    tr.className = trClass;
    tr.innerHTML = `
      <td>${index + 1}</td>
      <td>${p.nama || '-'}</td>
      <td>${p.kelas || '-'}</td>
      <td>${p.uno || 0}</td>
      <td>${p.catur || 0}</td>
      <td>${p.uno_balok || 0}</td>
      <td>${p.tepok_nyamuk || 0}</td>
      <td>${p.total_score || 0}</td>
      <td>${getBadges(p)}</td>
    `;
    tbody.appendChild(tr);
  });
}

function filterData() {
  const query = document.getElementById("searchInput").value.trim().toLowerCase();
  const playerCard = document.getElementById("playerCard");

  if (!query) {
    renderTable(allPlayers);
    playerCard.style.display = "none";
    return;
  }

  const filtered = allPlayers.filter(p => (p.nama || "").toLowerCase().includes(query));
  renderTable(filtered);

  if (filtered.length > 0) {
    const p = filtered[0];
    document.getElementById("playerPhoto").src = p.foto || "assets/img/default.png";
    document.getElementById("playerName").textContent = p.nama || "-";
    document.getElementById("playerClass").textContent = p.kelas || "-";
    document.getElementById("playerTotal").textContent = p.total_score || "0";
    document.getElementById("playerBadges").innerHTML = getBadges(p);
    playerCard.style.display = "block";
  } else {
    playerCard.style.display = "none";
  }
}
</script>

<script>
function goToBadgeGallery() {
  window.location.href = "badgegalery.html"; // ganti dengan link halaman galeri badge
}

function adminPage(){
  window.location.href = "admin.html"; // ganti dengan link halaman admin
}
</script>
</body>
</html>
